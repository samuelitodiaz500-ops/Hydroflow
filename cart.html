<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hydroflow Irrigation - Checkout</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ============ CSS Variables ============ */
    :root {
      /* Brand Colors - Maintained from original */
      --bg: #f7faf9;
      --card: #ffffff;
      --muted: #6b7280;
      --accent: #0f8a5f;
      --accent-dark: #04623f;
      --glass: rgba(255, 255, 255, 0.7);
      
      /* Jumia-inspired additions */
      --orange: #ff6600;
      --yellow: #ffd700;
      --blue: #0d6efd;
      --light-gray: #f8f9fa;
      --dark-gray: #343a40;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --shadow-hover: 0 8px 20px rgba(0, 0, 0, 0.12);
    }
    
    /* ============ Base Styles ============ */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: var(--bg);
      color: #111827;
      line-height: 1.6;
    }
    
    a {
      text-decoration: none;
      color: inherit;
    }
    
    ul {
      list-style: none;
    }
    
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 15px;
    }
    
    .btn {
      display: inline-block;
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      text-align: center;
    }
    
    .btn-primary {
      background-color: var(--accent);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: var(--accent-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }
    
    .btn-secondary {
      background-color: var(--orange);
      color: white;
    }
    
    .btn-secondary:hover {
      background-color: #e55a00;
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }
    
    .btn-outline {
      background-color: transparent;
      color: var(--accent);
      border: 2px solid var(--accent);
    }
    
    .btn-outline:hover {
      background-color: var(--accent);
      color: white;
    }
    
    .section-title {
      font-size: 24px;
      margin-bottom: 24px;
      color: var(--accent-dark);
      position: relative;
      padding-bottom: 10px;
    }
    
    .section-title:after {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      width: 60px;
      height: 3px;
      background-color: var(--accent);
    }
    
    /* ============ Header & Navigation ============ */
    .header {
      background-color: var(--card);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    
    .header-top {
      background-color: var(--accent-dark);
      color: white;
      padding: 8px 0;
      font-size: 14px;
    }
    
    .header-top .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header-top-links a {
      margin-left: 20px;
      transition: opacity 0.3s;
    }
    
    .header-top-links a:hover {
      opacity: 0.8;
    }
    
    .header-main {
      padding: 15px 0;
    }
    
    .header-main .container {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo img {
      height: 48px;
    }
    
    .logo h1 {
      font-size: 22px;
      color: var(--accent);
      margin: 0;
    }
    
    .search-bar {
      flex: 1;
      max-width: 500px;
      margin: 0 30px;
      position: relative;
    }
    
    .search-bar input {
      width: 100%;
      padding: 12px 20px;
      border-radius: 30px;
      border: 1px solid #e2e8f0;
      font-size: 16px;
      outline: none;
      transition: border 0.3s;
    }
    
    .search-bar input:focus {
      border-color: var(--accent);
    }
    
    .search-bar button {
      position: absolute;
      right: 5px;
      top: 5px;
      background-color: var(--accent);
      color: white;
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      cursor: pointer;
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .header-action {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 12px;
      cursor: pointer;
      transition: color 0.3s;
    }
    
    .header-action:hover {
      color: var(--accent);
    }
    
    .header-action i {
      font-size: 20px;
      margin-bottom: 4px;
    }
    
    .cart-icon {
      position: relative;
    }
    
    .cart-count {
      position: absolute;
      top: -8px;
      right: -8px;
      background-color: var(--orange);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .categories-nav {
      background-color: var(--accent);
      color: white;
    }
    
    .categories-nav .container {
      display: flex;
      align-items: center;
    }
    
    .categories-toggle {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      background-color: var(--accent-dark);
      cursor: pointer;
      font-weight: 600;
    }
    
    .categories-toggle i {
      margin-right: 10px;
    }
    
    .categories-menu {
      display: flex;
      margin-left: 30px;
    }
    
    .categories-menu a {
      padding: 15px 20px;
      transition: background-color 0.3s;
    }
    
    .categories-menu a:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    /* ============ Checkout Page ============ */
    .checkout-page {
      padding: 40px 0;
    }
    
    .checkout-container {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
    }
    
    @media (max-width: 992px) {
      .checkout-container {
        grid-template-columns: 1fr;
      }
    }
    
    .checkout-progress {
      display: flex;
      justify-content: space-between;
      margin-bottom: 40px;
      position: relative;
    }
    
    .checkout-progress:before {
      content: '';
      position: absolute;
      top: 15px;
      left: 0;
      right: 0;
      height: 2px;
      background-color: #e2e8f0;
      z-index: 1;
    }
    
    .progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
    }
    
    .step-circle {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: white;
      border: 2px solid #e2e8f0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      margin-bottom: 10px;
      transition: all 0.3s;
    }
    
    .progress-step.active .step-circle {
      background-color: var(--accent);
      border-color: var(--accent);
      color: white;
    }
    
    .progress-step.completed .step-circle {
      background-color: var(--success);
      border-color: var(--success);
      color: white;
    }
    
    .step-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--muted);
    }
    
    .progress-step.active .step-label {
      color: var(--accent);
    }
    
    .progress-step.completed .step-label {
      color: var(--success);
    }
    
    .checkout-form-section {
      background-color: var(--card);
      border-radius: 12px;
      padding: 30px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }
    
    .form-section-title {
      font-size: 18px;
      color: var(--dark-gray);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .form-section-title i {
      color: var(--accent);
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--dark-gray);
    }
    
    .form-group.required label:after {
      content: ' *';
      color: var(--danger);
    }
    
    .form-control {
      width: 100%;
      padding: 14px 16px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      font-size: 16px;
      transition: border 0.3s, box-shadow 0.3s;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(15, 138, 95, 0.1);
    }
    
    .select-wrapper {
      position: relative;
    }
    
    .select-wrapper:after {
      content: '\f078';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      pointer-events: none;
    }
    
    .select-wrapper select {
      appearance: none;
      width: 100%;
      padding: 14px 16px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      font-size: 16px;
      background-color: white;
      cursor: pointer;
    }
    
    /* Delivery Options */
    .delivery-options {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .delivery-option {
      flex: 1;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .delivery-option.selected {
      border-color: var(--accent);
      background-color: rgba(15, 138, 95, 0.05);
    }
    
    .delivery-option-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .delivery-option-title {
      font-weight: 600;
      color: var(--dark-gray);
    }
    
    .delivery-option-price {
      font-weight: 700;
      color: var(--accent);
    }
    
    .delivery-option-desc {
      font-size: 14px;
      color: var(--muted);
    }
    
    /* Payment Methods */
    .payment-methods {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .payment-method {
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .payment-method.selected {
      border-color: var(--accent);
      background-color: rgba(15, 138, 95, 0.05);
    }
    
    .payment-method-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 10px;
    }
    
    .payment-method-icon {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      background-color: #f8f9fa;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    
    .payment-method-icon.mpesa {
      background-color: #0a6934;
      color: white;
    }
    
    .payment-method-icon.card {
      background-color: #0d6efd;
      color: white;
    }
    
    .payment-method-icon.cash {
      background-color: #6f42c1;
      color: white;
    }
    
    .payment-method-title {
      font-weight: 600;
      color: var(--dark-gray);
    }
    
    .payment-method-desc {
      font-size: 14px;
      color: var(--muted);
      margin-left: 65px;
    }
    
    /* M-Pesa Payment Form */
    .mpesa-form {
      background-color: rgba(10, 105, 52, 0.05);
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      display: none;
    }
    
    .mpesa-form.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .mpesa-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .mpesa-logo {
      width: 40px;
      height: 40px;
      background-color: #0a6934;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      font-weight: 700;
    }
    
    .mpesa-header h4 {
      color: #0a6934;
      margin: 0;
    }
    
    .mpesa-steps {
      margin-bottom: 20px;
    }
    
    .mpesa-step {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      font-size: 14px;
    }
    
    .mpesa-step i {
      color: var(--success);
    }
    
    /* Order Summary */
    .order-summary {
      background-color: var(--card);
      border-radius: 12px;
      padding: 30px;
      box-shadow: var(--shadow);
      height: fit-content;
      position: sticky;
      top: 100px;
    }
    
    .order-summary h3 {
      font-size: 18px;
      color: var(--dark-gray);
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e2e8f0;
    }
    
    .order-items {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 20px;
    }
    
    .order-item {
      display: flex;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .order-item:last-child {
      border-bottom: none;
    }
    
    .order-item-image {
      width: 60px;
      height: 60px;
      border-radius: 6px;
      overflow: hidden;
      margin-right: 15px;
      flex-shrink: 0;
    }
    
    .order-item-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .order-item-info {
      flex: 1;
    }
    
    .order-item-name {
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 14px;
    }
    
    .order-item-qty {
      font-size: 14px;
      color: var(--muted);
    }
    
    .order-item-price {
      font-weight: 600;
      color: var(--accent);
      font-size: 14px;
    }
    
    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .summary-row.total {
      font-size: 20px;
      font-weight: 700;
      color: var(--accent);
      border-bottom: none;
      padding-top: 15px;
    }
    
    .delivery-estimate {
      background-color: rgba(15, 138, 95, 0.1);
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
      font-size: 14px;
    }
    
    .delivery-estimate i {
      color: var(--accent);
      margin-right: 10px;
    }
    
    .checkout-actions {
      margin-top: 30px;
    }
    
    .checkout-actions .btn {
      width: 100%;
      margin-bottom: 10px;
    }
    
    /* Footer */
    .footer {
      background-color: var(--dark-gray);
      color: white;
      padding: 50px 0 20px;
      margin-top: 50px;
    }
    
    .footer-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 40px;
      margin-bottom: 40px;
    }
    
    .footer-column h3 {
      font-size: 18px;
      margin-bottom: 20px;
      color: white;
      position: relative;
      padding-bottom: 10px;
    }
    
    .footer-column h3:after {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      width: 40px;
      height: 3px;
      background-color: var(--accent);
    }
    
    .footer-links li {
      margin-bottom: 10px;
    }
    
    .footer-links a {
      color: #ccc;
      transition: color 0.3s;
    }
    
    .footer-links a:hover {
      color: white;
    }
    
    .social-links {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }
    
    .social-links a {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      transition: background-color 0.3s;
    }
    
    .social-links a:hover {
      background-color: var(--accent);
    }
    
    .newsletter-form {
      display: flex;
      margin-top: 15px;
    }
    
    .newsletter-form input {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 4px 0 0 4px;
    }
    
    .newsletter-form button {
      background-color: var(--accent);
      color: white;
      border: none;
      padding: 0 20px;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
    }
    
    .footer-bottom {
      text-align: center;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 14px;
      color: #aaa;
    }
    
    /* ============ Modal & Messages ============ */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.5);
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: 20px;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background-color: white;
      border-radius: 12px;
      padding: 30px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      animation: modalFadeIn 0.3s ease;
    }
    
    @keyframes modalFadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-header h3 {
      margin: 0;
      color: var(--dark-gray);
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
    }
    
    .message {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
    }
    
    .message.error {
      background-color: rgba(220, 53, 69, 0.1);
      color: var(--danger);
      border-left: 4px solid var(--danger);
      display: block;
    }
    
    .message.success {
      background-color: rgba(40, 167, 69, 0.1);
      color: var(--success);
      border-left: 4px solid var(--success);
      display: block;
    }
    
    .message.info {
      background-color: rgba(13, 110, 253, 0.1);
      color: var(--blue);
      border-left: 4px solid var(--blue);
      display: block;
    }
    
    /* ============ Responsive Design ============ */
    @media (max-width: 1200px) {
      .container {
        padding: 0 20px;
      }
    }
    
    @media (max-width: 992px) {
      .header-main .container {
        flex-wrap: wrap;
      }
      
      .search-bar {
        order: 3;
        max-width: 100%;
        margin: 15px 0 0;
      }
      
      .categories-menu {
        display: none;
      }
      
      .categories-toggle {
        width: 100%;
        justify-content: center;
      }
      
      .delivery-options {
        flex-direction: column;
      }
    }
    
    @media (max-width: 768px) {
      .header-top {
        display: none;
      }
      
      .checkout-progress {
        flex-direction: column;
        align-items: flex-start;
        gap: 20px;
      }
      
      .checkout-progress:before {
        display: none;
      }
      
      .progress-step {
        flex-direction: row;
        gap: 15px;
      }
      
      .step-circle {
        margin-bottom: 0;
      }
    }
    
    @media (max-width: 576px) {
      .header-actions {
        gap: 10px;
      }
      
      .header-action span {
        display: none;
      }
      
      .logo h1 {
        font-size: 18px;
      }
      
      .checkout-form-section,
      .order-summary {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-top">
      <div class="container">
        <div>Free shipping on orders over KES 5,000</div>
        <div class="header-top-links">
          <a href="#"><i class="fas fa-map-marker-alt"></i> Store Locator</a>
          <a href="#"><i class="fas fa-question-circle"></i> Help Center</a>
          <a href="#"><i class="fas fa-phone"></i> +254 700 000 000</a>
        </div>
      </div>
    </div>
    
    <div class="header-main">
      <div class="container">
        <div class="logo">
          <img src="https://i.imghippo.com/files/fxTg6933gaE.png" alt="Hydroflow Irrigation">
          <h1>Hydroflow Irrigation</h1>
        </div>
        
        <div class="search-bar">
          <input type="text" placeholder="Search for irrigation products, pipes, fittings...">
          <button><i class="fas fa-search"></i></button>
        </div>
        
        <div class="header-actions">
          <div class="header-action">
            <i class="fas fa-user"></i>
            <span>Account</span>
          </div>
          <div class="header-action">
            <i class="fas fa-heart"></i>
            <span>Wishlist</span>
          </div>
          <div class="header-action cart-icon">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count" id="cartCount">0</span>
            <span>Cart</span>
          </div>
        </div>
      </div>
    </div>
    
    <nav class="categories-nav">
      <div class="container">
        <div class="categories-toggle">
          <i class="fas fa-bars"></i>
          <span>All Categories</span>
        </div>
        <div class="categories-menu">
          <a href="index.html">Home</a>
          <a href="listing.html">HDPE Pipes</a>
          <a href="listing.html">Fittings & Valves</a>
          <a href="listing.html">Sprinklers</a>
          <a href="listing.html">Drip Irrigation</a>
          <a href="listing.html">Greenhouse Supplies</a>
          <a href="listing.html">Tools & Accessories</a>
        </div>
      </div>
    </nav>
  </header>

  <!-- Checkout Page -->
  <main class="checkout-page">
    <div class="container">
      <h1 class="section-title">Checkout</h1>
      
      <!-- Checkout Progress -->
      <div class="checkout-progress">
        <div class="progress-step active" id="step1">
          <div class="step-circle">1</div>
          <div class="step-label">Shipping</div>
        </div>
        <div class="progress-step" id="step2">
          <div class="step-circle">2</div>
          <div class="step-label">Delivery</div>
        </div>
        <div class="progress-step" id="step3">
          <div class="step-circle">3</div>
          <div class="step-label">Payment</div>
        </div>
        <div class="progress-step" id="step4">
          <div class="step-circle">4</div>
          <div class="step-label">Confirmation</div>
        </div>
      </div>
      
      <!-- Checkout Form -->
      <div class="checkout-container">
        <div class="checkout-form">
          <!-- Shipping Information -->
          <div class="checkout-form-section" id="shippingSection">
            <div class="form-section-title">
              <i class="fas fa-user"></i>
              <span>Shipping Information</span>
            </div>
            
            <div id="shippingMessage" class="message"></div>
            
            <form id="shippingForm">
              <div class="form-row">
                <div class="form-group required">
                  <label for="firstName">First Name</label>
                  <input type="text" id="firstName" class="form-control" placeholder="John" required>
                </div>
                <div class="form-group required">
                  <label for="lastName">Last Name</label>
                  <input type="text" id="lastName" class="form-control" placeholder="Doe" required>
                </div>
              </div>
              
              <div class="form-group required">
                <label for="email">Email Address</label>
                <input type="email" id="email" class="form-control" placeholder="your@email.com" required>
              </div>
              
              <div class="form-group required">
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" class="form-control" placeholder="+254 700 000 000" required>
              </div>
              
              <div class="form-group required">
                <label for="address">Street Address</label>
                <input type="text" id="address" class="form-control" placeholder="Street name and house number" required>
              </div>
              
              <div class="form-row">
                <div class="form-group required">
                  <label for="city">City/Town</label>
                  <input type="text" id="city" class="form-control" placeholder="Nairobi" required>
                </div>
                <div class="form-group required">
                  <label for="postalCode">Postal Code</label>
                  <input type="text" id="postalCode" class="form-control" placeholder="00100" required>
                </div>
              </div>
              
              <div class="form-group required">
                <label for="county">County</label>
                <div class="select-wrapper">
                  <select id="county" class="form-control" required>
                    <option value="">Select County</option>
                    <option value="nairobi">Nairobi</option>
                    <option value="mombasa">Mombasa</option>
                    <option value="kisumu">Kisumu</option>
                    <option value="nakuru">Nakuru</option>
                    <option value="kiambu">Kiambu</option>
                    <option value="nyeri">Nyeri</option>
                    <option value="eldoret">Uasin Gishu (Eldoret)</option>
                    <option value="kakamega">Kakamega</option>
                    <option value="kisii">Kisii</option>
                    <option value="other">Other</option>
                  </select>
                </div>
              </div>
              
              <div class="form-group">
                <label for="notes">Delivery Notes (Optional)</label>
                <textarea id="notes" class="form-control" rows="3" placeholder="Any specific delivery instructions..."></textarea>
              </div>
              
              <button type="submit" class="btn btn-primary" style="width: 100%;">Continue to Delivery</button>
            </form>
          </div>
          
          <!-- Delivery Options -->
          <div class="checkout-form-section" id="deliverySection" style="display: none;">
            <div class="form-section-title">
              <i class="fas fa-truck"></i>
              <span>Delivery Options</span>
            </div>
            
            <div id="deliveryMessage" class="message"></div>
            
            <div class="delivery-options">
              <div class="delivery-option" data-type="standard">
                <div class="delivery-option-header">
                  <div class="delivery-option-title">Standard Delivery</div>
                  <div class="delivery-option-price" id="standardPrice">KES 0</div>
                </div>
                <div class="delivery-option-desc">Delivery within 3-5 business days</div>
              </div>
              
              <div class="delivery-option" data-type="express">
                <div class="delivery-option-header">
                  <div class="delivery-option-title">Express Delivery</div>
                  <div class="delivery-option-price" id="expressPrice">KES 0</div>
                </div>
                <div class="delivery-option-desc">Delivery within 1-2 business days</div>
              </div>
              
              <div class="delivery-option" data-type="pickup">
                <div class="delivery-option-header">
                  <div class="delivery-option-title">Store Pickup</div>
                  <div class="delivery-option-price">KES 0</div>
                </div>
                <div class="delivery-option-desc">Pick up from our Nairobi warehouse</div>
              </div>
            </div>
            
            <div class="checkout-actions">
              <button class="btn btn-outline" id="backToShipping">Back</button>
              <button class="btn btn-primary" id="continueToPayment">Continue to Payment</button>
            </div>
          </div>
          
          <!-- Payment Method -->
          <div class="checkout-form-section" id="paymentSection" style="display: none;">
            <div class="form-section-title">
              <i class="fas fa-credit-card"></i>
              <span>Payment Method</span>
            </div>
            
            <div id="paymentMessage" class="message"></div>
            
            <div class="payment-methods">
              <div class="payment-method" data-method="mpesa">
                <div class="payment-method-header">
                  <div class="payment-method-icon mpesa">
                    <i class="fas fa-mobile-alt"></i>
                  </div>
                  <div>
                    <div class="payment-method-title">M-Pesa</div>
                    <div class="payment-method-desc">Pay securely with M-Pesa</div>
                  </div>
                </div>
              </div>
              
              <div class="payment-method" data-method="card">
                <div class="payment-method-header">
                  <div class="payment-method-icon card">
                    <i class="fas fa-credit-card"></i>
                  </div>
                  <div>
                    <div class="payment-method-title">Credit/Debit Card</div>
                    <div class="payment-method-desc">Visa, Mastercard, American Express</div>
                  </div>
                </div>
              </div>
              
              <div class="payment-method" data-method="cash">
                <div class="payment-method-header">
                  <div class="payment-method-icon cash">
                    <i class="fas fa-money-bill-wave"></i>
                  </div>
                  <div>
                    <div class="payment-method-title">Cash on Delivery</div>
                    <div class="payment-method-desc">Pay when you receive your order</div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- M-Pesa Payment Form -->
            <div class="mpesa-form" id="mpesaForm">
              <div class="mpesa-header">
                <div class="mpesa-logo">M</div>
                <h4>M-Pesa Payment</h4>
              </div>
              
              <div class="mpesa-steps">
                <div class="mpesa-step">
                  <i class="fas fa-check-circle"></i>
                  <span>Enter your M-Pesa registered phone number</span>
                </div>
                <div class="mpesa-step">
                  <i class="fas fa-info-circle"></i>
                  <span>You will receive a payment request on your phone</span>
                </div>
                <div class="mpesa-step">
                  <i class="fas fa-lock"></i>
                  <span>Enter your M-Pesa PIN to complete payment</span>
                </div>
              </div>
              
              <div class="form-group required">
                <label for="mpesaPhone">M-Pesa Phone Number</label>
                <input type="tel" id="mpesaPhone" class="form-control" placeholder="07XX XXX XXX" required>
              </div>
              
              <button class="btn btn-primary" id="payWithMpesa" style="width: 100%;">
                <i class="fas fa-paper-plane"></i> Pay with M-Pesa
              </button>
            </div>
            
            <div class="checkout-actions">
              <button class="btn btn-outline" id="backToDelivery">Back</button>
              <button class="btn btn-primary" id="placeOrder">Place Order</button>
            </div>
          </div>
        </div>
        
        <!-- Order Summary -->
        <div class="order-summary">
          <h3>Order Summary</h3>
          
          <div class="order-items" id="orderItems">
            <!-- Order items will be populated by JavaScript -->
          </div>
          
          <div class="summary-row">
            <span>Subtotal</span>
            <span id="subtotal">KES 0</span>
          </div>
          
          <div class="summary-row">
            <span>Delivery Fee</span>
            <span id="deliveryFee">KES 0</span>
          </div>
          
          <div class="summary-row">
            <span>Tax (16% VAT)</span>
            <span id="tax">KES 0</span>
          </div>
          
          <div class="summary-row total">
            <span>Total</span>
            <span id="total">KES 0</span>
          </div>
          
          <div class="delivery-estimate">
            <i class="fas fa-info-circle"></i>
            <span>Delivery to: <strong id="deliveryLocation">Select location</strong></span>
            <div style="margin-top: 5px; font-size: 13px;" id="deliveryTime">Select delivery option</div>
          </div>
          
          <div class="checkout-actions">
            <button class="btn btn-outline" onclick="window.location.href='index.html'">
              <i class="fas fa-shopping-cart"></i> Continue Shopping
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-column">
          <h3>Hydroflow Irrigation</h3>
          <p>Your trusted partner for smart irrigation solutions. We provide high-quality products for efficient water management in agriculture.</p>
          <div class="social-links">
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-youtube"></i></a>
          </div>
        </div>
        
        <div class="footer-column">
          <h3>Quick Links</h3>
          <ul class="footer-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="listing.html">Products</a></li>
            <li><a href="#">About Us</a></li>
            <li><a href="#">Contact</a></li>
            <li><a href="#">FAQs</a></li>
          </ul>
        </div>
        
        <div class="footer-column">
          <h3>Customer Service</h3>
          <ul class="footer-links">
            <li><a href="#">Track Your Order</a></li>
            <li><a href="#">Return Policy</a></li>
            <li><a href="#">Shipping Info</a></li>
            <li><a href="#">Warranty</a></li>
            <li><a href="#">Privacy Policy</a></li>
          </ul>
        </div>
        
        <div class="footer-column">
          <h3>Newsletter</h3>
          <p>Subscribe to get updates on new products and special offers.</p>
          <div class="newsletter-form">
            <input type="email" placeholder="Your email address">
            <button type="submit"><i class="fas fa-paper-plane"></i></button>
          </div>
          <p class="mt-30">Need help? Call us at <strong>+254 704 302 723</strong></p>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>&copy; 2025 Hydroflow Irrigation Services. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Payment Processing Modal -->
  <div class="modal" id="paymentModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Processing Payment</h3>
        <button class="modal-close" id="closePaymentModal">&times;</button>
      </div>
      
      <div id="paymentStatus">
        <div style="text-align: center; padding: 30px;">
          <div class="payment-method-icon mpesa" style="margin: 0 auto 20px;">
            <i class="fas fa-mobile-alt"></i>
          </div>
          <h4>M-Pesa Payment Request Sent</h4>
          <p>Please check your phone and enter your M-Pesa PIN to complete the payment.</p>
          
          <div style="margin: 30px 0;">
            <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 15px;">
              <div style="font-size: 24px; color: var(--accent);">KES</div>
              <div style="font-size: 36px; font-weight: 700; color: var(--accent);" id="paymentAmount">0</div>
            </div>
            <p>To: <strong id="paymentMerchant">Hydroflow Irrigation</strong></p>
            <p>Phone: <strong id="paymentPhone">07XX XXX XXX</strong></p>
          </div>
          
          <div style="display: flex; gap: 10px;">
            <button class="btn btn-outline" id="cancelPayment">Cancel</button>
            <button class="btn btn-primary" id="paymentComplete">I've Completed Payment</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Order Confirmation Modal -->
  <div class="modal" id="confirmationModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Order Confirmed!</h3>
        <button class="modal-close" id="closeConfirmationModal">&times;</button>
      </div>
      
      <div style="text-align: center; padding: 20px;">
        <div style="width: 80px; height: 80px; background-color: var(--success); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; margin: 0 auto 20px;">
          <i class="fas fa-check"></i>
        </div>
        
        <h4>Thank You for Your Order!</h4>
        <p>Your order has been received and is being processed.</p>
        
        <div style="background-color: var(--light-gray); border-radius: 8px; padding: 20px; margin: 20px 0;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <span>Order Number:</span>
            <strong id="orderNumber">HYD-00123</strong>
          </div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <span>Order Total:</span>
            <strong id="orderTotalAmount">KES 0</strong>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <span>Payment Method:</span>
            <strong id="orderPaymentMethod">M-Pesa</strong>
          </div>
        </div>
        
        <p>You will receive an email confirmation shortly. We'll notify you when your order ships.</p>
        
        <div style="display: flex; gap: 10px; margin-top: 30px;">
          <button class="btn btn-outline" onclick="window.location.href='index.html'">
            <i class="fas fa-home"></i> Back to Home
          </button>
          <button class="btn btn-primary" onclick="window.location.href='listing.html'">
            <i class="fas fa-shopping-cart"></i> Continue Shopping
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============ DATA CONFIGURATION ============
    
    // Delivery fees based on county
    const DELIVERY_FEES = {
      nairobi: {
        standard: 500,
        express: 1000,
        pickup: 0
      },
      mombasa: {
        standard: 1200,
        express: 2000,
        pickup: 0
      },
      kisumu: {
        standard: 1000,
        express: 1800,
        pickup: 0
      },
      nakuru: {
        standard: 800,
        express: 1500,
        pickup: 0
      },
      kiambu: {
        standard: 600,
        express: 1200,
        pickup: 0
      },
      nyeri: {
        standard: 900,
        express: 1600,
        pickup: 0
      },
      eldoret: {
        standard: 1100,
        express: 1900,
        pickup: 0
      },
      kakamega: {
        standard: 1000,
        express: 1800,
        pickup: 0
      },
      kisii: {
        standard: 1100,
        express: 2000,
        pickup: 0
      },
      other: {
        standard: 1500,
        express: 2500,
        pickup: 0
      },
      default: {
        standard: 1000,
        express: 1800,
        pickup: 0
      }
    };
    
    // Sample cart data (in real app, this would come from localStorage)
    let cart = JSON.parse(localStorage.getItem('hydroflow_cart')) || [
      {
        id: 1,
        name: "HDPE Pipe 32mm PN10 - 100m",
        price: 6000,
        image: "https://via.placeholder.com/600x400?text=HDPE+Pipe+32mm",
        quantity: 1
      },
      {
        id: 2,
        name: "HDPE Coupling 20mm",
        price: 100,
        image: "https://via.placeholder.com/600x400?text=HDPE+Coupling",
        quantity: 3
      },
      {
        id: 3,
        name: "Ball Valve 1\" Double Union",
        price: 1200,
        image: "https://via.placeholder.com/600x400?text=Ball+Valve",
        quantity: 1
      }
    ];
    
    // Checkout state
    const checkoutState = {
      step: 1,
      shippingInfo: {},
      deliveryOption: null,
      paymentMethod: null,
      deliveryFee: 0
    };
    
    // ============ UTILITY FUNCTIONS ============
    function formatKES(amount) {
      return 'KES ' + amount.toLocaleString('en-KE');
    }
    
    function showMessage(elementId, message, type = 'error') {
      const element = document.getElementById(elementId);
      element.textContent = message;
      element.className = `message ${type}`;
      
      // Auto hide success messages after 5 seconds
      if (type === 'success') {
        setTimeout(() => {
          element.className = 'message';
        }, 5000);
      }
    }
    
    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }
    
    function validatePhone(phone) {
      const re = /^[\+]?[0-9\s\-\(\)]{10,}$/;
      return re.test(phone.replace(/\s/g, ''));
    }
    
    // ============ CART FUNCTIONS ============
    function updateCartCount() {
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cartCount').textContent = totalItems;
    }
    
    function calculateCartTotals() {
      const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const deliveryFee = checkoutState.deliveryFee || 0;
      const tax = (subtotal + deliveryFee) * 0.16; // 16% VAT
      const total = subtotal + deliveryFee + tax;
      
      return { subtotal, deliveryFee, tax, total };
    }
    
    function updateOrderSummary() {
      const { subtotal, deliveryFee, tax, total } = calculateCartTotals();
      
      document.getElementById('subtotal').textContent = formatKES(subtotal);
      document.getElementById('deliveryFee').textContent = formatKES(deliveryFee);
      document.getElementById('tax').textContent = formatKES(tax);
      document.getElementById('total').textContent = formatKES(total);
      
      // Update payment modal amount
      document.getElementById('paymentAmount').textContent = total.toLocaleString('en-KE');
    }
    
    function renderOrderItems() {
      const container = document.getElementById('orderItems');
      if (!container) return;
      
      container.innerHTML = cart.map(item => `
        <div class="order-item">
          <div class="order-item-image">
            <img src="${item.image}" alt="${item.name}">
          </div>
          <div class="order-item-info">
            <div class="order-item-name">${item.name}</div>
            <div class="order-item-qty">Qty: ${item.quantity}</div>
          </div>
          <div class="order-item-price">${formatKES(item.price * item.quantity)}</div>
        </div>
      `).join('');
    }
    
    // ============ DELIVERY FEE CALCULATION ============
    function calculateDeliveryFee(county, deliveryType) {
      const countyData = DELIVERY_FEES[county] || DELIVERY_FEES.default;
      return countyData[deliveryType] || 0;
    }
    
    function updateDeliveryPrices(county) {
      const standardPrice = calculateDeliveryFee(county, 'standard');
      const expressPrice = calculateDeliveryFee(county, 'express');
      
      document.getElementById('standardPrice').textContent = formatKES(standardPrice);
      document.getElementById('expressPrice').textContent = formatKES(expressPrice);
    }
    
    // ============ CHECKOUT NAVIGATION ============
    function goToStep(step) {
      // Hide all sections
      document.getElementById('shippingSection').style.display = 'none';
      document.getElementById('deliverySection').style.display = 'none';
      document.getElementById('paymentSection').style.display = 'none';
      
      // Remove active class from all steps
      document.querySelectorAll('.progress-step').forEach(stepEl => {
        stepEl.classList.remove('active', 'completed');
      });
      
      // Show current section and update steps
      switch(step) {
        case 1:
          document.getElementById('shippingSection').style.display = 'block';
          document.getElementById('step1').classList.add('active');
          break;
        case 2:
          document.getElementById('deliverySection').style.display = 'block';
          document.getElementById('step1').classList.add('completed');
          document.getElementById('step2').classList.add('active');
          break;
        case 3:
          document.getElementById('paymentSection').style.display = 'block';
          document.getElementById('step1').classList.add('completed');
          document.getElementById('step2').classList.add('completed');
          document.getElementById('step3').classList.add('active');
          break;
        case 4:
          document.getElementById('step1').classList.add('completed');
          document.getElementById('step2').classList.add('completed');
          document.getElementById('step3').classList.add('completed');
          document.getElementById('step4').classList.add('active');
          break;
      }
      
      checkoutState.step = step;
    }
    
    // ============ FORM HANDLERS ============
    function handleShippingForm(e) {
      e.preventDefault();
      
      const firstName = document.getElementById('firstName').value.trim();
      const lastName = document.getElementById('lastName').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const address = document.getElementById('address').value.trim();
      const city = document.getElementById('city').value.trim();
      const postalCode = document.getElementById('postalCode').value.trim();
      const county = document.getElementById('county').value;
      
      // Validation
      if (!firstName || !lastName) {
        showMessage('shippingMessage', 'Please enter your full name', 'error');
        return;
      }
      
      if (!validateEmail(email)) {
        showMessage('shippingMessage', 'Please enter a valid email address', 'error');
        return;
      }
      
      if (!validatePhone(phone)) {
        showMessage('shippingMessage', 'Please enter a valid phone number', 'error');
        return;
      }
      
      if (!address || !city || !postalCode) {
        showMessage('shippingMessage', 'Please enter your complete address', 'error');
        return;
      }
      
      if (!county) {
        showMessage('shippingMessage', 'Please select your county', 'error');
        return;
      }
      
      // Save shipping info
      checkoutState.shippingInfo = {
        firstName,
        lastName,
        email,
        phone,
        address,
        city,
        postalCode,
        county,
        notes: document.getElementById('notes').value.trim()
      };
      
      // Update delivery location display
      const countyNames = {
        nairobi: 'Nairobi',
        mombasa: 'Mombasa',
        kisumu: 'Kisumu',
        nakuru: 'Nakuru',
        kiambu: 'Kiambu',
        nyeri: 'Nyeri',
        eldoret: 'Uasin Gishu (Eldoret)',
        kakamega: 'Kakamega',
        kisii: 'Kisii',
        other: 'Other Counties'
      };
      
      document.getElementById('deliveryLocation').textContent = `${countyNames[county] || county}`;
      
      // Update delivery prices based on county
      updateDeliveryPrices(county);
      
      // Go to next step
      goToStep(2);
    }
    
    function handleDeliverySelection() {
      const selectedOption = document.querySelector('.delivery-option.selected');
      if (!selectedOption) {
        showMessage('deliveryMessage', 'Please select a delivery option', 'error');
        return false;
      }
      
      const deliveryType = selectedOption.dataset.type;
      const county = checkoutState.shippingInfo.county;
      
      // Calculate delivery fee
      checkoutState.deliveryFee = calculateDeliveryFee(county, deliveryType);
      checkoutState.deliveryOption = deliveryType;
      
      // Update delivery time display
      let deliveryTime = '';
      switch(deliveryType) {
        case 'standard':
          deliveryTime = '3-5 business days';
          break;
        case 'express':
          deliveryTime = '1-2 business days';
          break;
        case 'pickup':
          deliveryTime = 'Ready for pickup tomorrow';
          break;
      }
      
      document.getElementById('deliveryTime').textContent = `Estimated delivery: ${deliveryTime}`;
      
      // Update order summary with new delivery fee
      updateOrderSummary();
      
      return true;
    }
    
    function handlePaymentSelection() {
      const selectedMethod = document.querySelector('.payment-method.selected');
      if (!selectedMethod) {
        showMessage('paymentMessage', 'Please select a payment method', 'error');
        return false;
      }
      
      checkoutState.paymentMethod = selectedMethod.dataset.method;
      
      // Show/hide M-Pesa form
      const mpesaForm = document.getElementById('mpesaForm');
      if (checkoutState.paymentMethod === 'mpesa') {
        mpesaForm.classList.add('active');
        
        // Auto-fill M-Pesa phone with shipping phone
        const mpesaPhone = document.getElementById('mpesaPhone');
        mpesaPhone.value = checkoutState.shippingInfo.phone.replace(/\s/g, '');
      } else {
        mpesaForm.classList.remove('active');
      }
      
      return true;
    }
    
    function handleMpesaPayment() {
      const mpesaPhone = document.getElementById('mpesaPhone').value.trim();
      
      if (!validatePhone(mpesaPhone)) {
        showMessage('paymentMessage', 'Please enter a valid M-Pesa phone number', 'error');
        return;
      }
      
      // Show payment modal
      document.getElementById('paymentModal').classList.add('active');
      document.getElementById('paymentPhone').textContent = mpesaPhone;
    }
    
    function simulateMpesaPayment() {
      // In a real application, this would integrate with M-Pesa API
      // For demo purposes, we simulate the payment process
      
      const { total } = calculateCartTotals();
      const mpesaPhone = document.getElementById('mpesaPhone').value;
      
      console.log(`Simulating M-Pesa payment of ${formatKES(total)} to ${mpesaPhone}`);
      
      // Simulate API call delay
      setTimeout(() => {
        // Simulate successful payment
        completeOrder();
      }, 2000);
    }
    
    function completeOrder() {
      // Generate order number
      const orderNumber = 'HYD-' + Date.now().toString().slice(-6);
      
      // Save order to localStorage (in real app, send to backend)
      const orders = JSON.parse(localStorage.getItem('hydroflow_orders')) || [];
      const order = {
        id: orderNumber,
        date: new Date().toISOString(),
        items: cart,
        shipping: checkoutState.shippingInfo,
        delivery: {
          option: checkoutState.deliveryOption,
          fee: checkoutState.deliveryFee
        },
        payment: {
          method: checkoutState.paymentMethod,
          amount: calculateCartTotals().total
        },
        status: 'processing'
      };
      
      orders.push(order);
      localStorage.setItem('hydroflow_orders', JSON.stringify(orders));
      
      // Clear cart
      cart = [];
      localStorage.setItem('hydroflow_cart', JSON.stringify(cart));
      updateCartCount();
      
      // Update confirmation modal
      document.getElementById('orderNumber').textContent = orderNumber;
      document.getElementById('orderTotalAmount').textContent = formatKES(order.payment.amount);
      document.getElementById('orderPaymentMethod').textContent = 
        checkoutState.paymentMethod === 'mpesa' ? 'M-Pesa' : 
        checkoutState.paymentMethod === 'card' ? 'Credit Card' : 'Cash on Delivery';
      
      // Close payment modal and show confirmation
      document.getElementById('paymentModal').classList.remove('active');
      document.getElementById('confirmationModal').classList.add('active');
      
      // Update progress to step 4
      goToStep(4);
    }
    
    // ============ EVENT LISTENERS ============
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize cart
      updateCartCount();
      renderOrderItems();
      updateOrderSummary();
      
      // Shipping form submission
      document.getElementById('shippingForm').addEventListener('submit', handleShippingForm);
      
      // County change updates delivery prices
      document.getElementById('county').addEventListener('change', function() {
        if (this.value) {
          updateDeliveryPrices(this.value);
        }
      });
      
      // Delivery option selection
      document.querySelectorAll('.delivery-option').forEach(option => {
        option.addEventListener('click', function() {
          document.querySelectorAll('.delivery-option').forEach(opt => {
            opt.classList.remove('selected');
          });
          this.classList.add('selected');
          
          // Clear any error messages
          document.getElementById('deliveryMessage').className = 'message';
        });
      });
      
      // Payment method selection
      document.querySelectorAll('.payment-method').forEach(method => {
        method.addEventListener('click', function() {
          document.querySelectorAll('.payment-method').forEach(m => {
            m.classList.remove('selected');
          });
          this.classList.add('selected');
          
          handlePaymentSelection();
          
          // Clear any error messages
          document.getElementById('paymentMessage').className = 'message';
        });
      });
      
      // Navigation buttons
      document.getElementById('backToShipping').addEventListener('click', () => goToStep(1));
      document.getElementById('continueToPayment').addEventListener('click', () => {
        if (handleDeliverySelection()) {
          goToStep(3);
        }
      });
      
      document.getElementById('backToDelivery').addEventListener('click', () => goToStep(2));
      document.getElementById('placeOrder').addEventListener('click', (e) => {
        e.preventDefault();
        
        if (!handlePaymentSelection()) return;
        
        if (checkoutState.paymentMethod === 'mpesa') {
          handleMpesaPayment();
        } else if (checkoutState.paymentMethod === 'cash') {
          completeOrder();
        } else {
          // For card payments, you would integrate with a payment gateway
          alert('Card payment integration would be implemented with a payment gateway like Stripe.');
        }
      });
      
      // M-Pesa payment button
      document.getElementById('payWithMpesa').addEventListener('click', (e) => {
        e.preventDefault();
        handleMpesaPayment();
      });
      
      // Payment modal buttons
      document.getElementById('paymentComplete').addEventListener('click', simulateMpesaPayment);
      document.getElementById('cancelPayment').addEventListener('click', () => {
        document.getElementById('paymentModal').classList.remove('active');
      });
      
      document.getElementById('closePaymentModal').addEventListener('click', () => {
        document.getElementById('paymentModal').classList.remove('active');
      });
      
      document.getElementById('closeConfirmationModal').addEventListener('click', () => {
        document.getElementById('confirmationModal').classList.remove('active');
      });
      
      // Close modals when clicking outside
      document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', function(e) {
          if (e.target === this) {
            this.classList.remove('active');
          }
        });
      });
    });
  </script>
</body>
</html>